<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DevTools Color Format Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f0f0f0;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border: 2px solid #333;
    }
    h1 {
      color: #2c3e50;
    }
    .button {
      background-color: #3498db;
      color: white;
      padding: 10px 20px;
      border: 1px solid #2980b9;
      cursor: pointer;
      margin: 10px 0;
    }
    .icon-box {
      width: 100px;
      height: 100px;
      background: #e74c3c;
      border: 3px solid #c0392b;
    }
    svg {
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>DevTools Color Format Test</h1>
    <p>This page tests the DevTools CSS Overview color analysis format.</p>

    <button class="button" onclick="runTest()">Run Color Analysis Test</button>

    <div class="icon-box"></div>

    <svg width="100" height="100">
      <circle cx="50" cy="50" r="40" fill="#9b59b6" stroke="#8e44ad" stroke-width="3"/>
    </svg>

    <pre id="output" style="background: #f8f8f8; padding: 15px; border: 1px solid #ddd; overflow: auto; max-height: 500px;"></pre>
  </div>

  <!-- Load extension scripts -->
  <script src="../color-analyzer.js"></script>
  <script src="../content-script-helpers.js"></script>

  <script>
    function runTest() {
      console.log('Running DevTools color format test...');

      // Initialize color data
      const colorData = ColorAnalyzer.initializeColorData();

      // Mock getSectionInfo and getBlockInfo
      const getSectionInfo = () => 'test-section';
      const getBlockInfo = () => 'test-block';

      // Scan all elements
      const allElements = document.querySelectorAll('*');
      console.log(`Scanning ${allElements.length} elements...`);

      allElements.forEach(element => {
        const tagName = element.tagName.toLowerCase();
        if (tagName === 'script' || tagName === 'style' || tagName === 'meta') {
          return;
        }

        try {
          const computed = window.getComputedStyle(element);
          const rect = element.getBoundingClientRect();

          if (rect.width > 0 && rect.height > 0) {
            // Track background color
            const bgColor = computed.backgroundColor;
            if (bgColor && !ColorAnalyzer.isTransparentColor(bgColor)) {
              ColorAnalyzer.trackColor(bgColor, element, 'background-color', null, colorData, getSectionInfo, getBlockInfo);
            }

            // Track text color
            const textColor = computed.color;
            if (textColor && !ColorAnalyzer.isTransparentColor(textColor)) {
              ColorAnalyzer.trackColor(textColor, element, 'color', null, colorData, getSectionInfo, getBlockInfo);
            }

            // Track border color
            const borderColor = computed.borderColor;
            if (borderColor && !ColorAnalyzer.isTransparentColor(borderColor)) {
              ColorAnalyzer.trackColor(borderColor, element, 'border-color', null, colorData, getSectionInfo, getBlockInfo);
            }

            // Track SVG fill/stroke
            if (element.tagName === 'svg' || element.tagName === 'SVG' ||
                element.ownerSVGElement || element.closest('svg')) {
              const fill = computed.fill;
              const stroke = computed.stroke;

              if (fill && !ColorAnalyzer.isTransparentColor(fill) && fill !== 'none') {
                ColorAnalyzer.trackColor(fill, element, 'fill', null, colorData, getSectionInfo, getBlockInfo);
              }

              if (stroke && !ColorAnalyzer.isTransparentColor(stroke) && stroke !== 'none') {
                ColorAnalyzer.trackColor(stroke, element, 'stroke', null, colorData, getSectionInfo, getBlockInfo);
              }
            }
          }
        } catch (e) {
          // Skip
        }
      });

      // Get DevTools format summary
      const summary = ColorAnalyzer.getDevToolsColorSummary(colorData);

      // Display results
      const output = document.getElementById('output');
      output.textContent = 'DevTools CSS Overview Color Summary:\n\n' +
        JSON.stringify(summary, null, 2);

      console.log('DevTools Summary:', summary);

      // Also log the raw colorData for comparison
      console.log('Raw colorData.colors:', colorData.colors);
      console.log('Background Set:', Array.from(colorData.backgroundColors));
      console.log('Text Set:', Array.from(colorData.textColors));
      console.log('Fill Set:', Array.from(colorData.fillColors));
      console.log('Border Set:', Array.from(colorData.borderColors));
      console.log('All Colors Set:', Array.from(colorData.allColors));
    }
  </script>
</body>
</html>
